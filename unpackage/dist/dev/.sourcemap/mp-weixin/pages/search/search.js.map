{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../EdgeDownload/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n  <view class=\"searchLayout\">\n    <view class=\"search\">\n      <uni-search-bar\n        @confirm=\"onSearch\"\n        @cancel=\"onClear\"\n        @clear=\"onClear\"\n        focus\n        placeholder=\"搜索\"\n        v-model=\"queryParams.keyword\"\n      >\n      </uni-search-bar>\n    </view>\n\n    <view v-show=\"!classList.length || noSearch\">\n      <view class=\"history\" v-if=\"historySearch.length\">\n        <view class=\"topTitle\">\n          <view class=\"text\">最近搜索</view>\n          <view class=\"icon\" @click=\"removeHistory\">\n            <uni-icons type=\"trash\" size=\"25\"></uni-icons>\n          </view>\n        </view>\n        <view class=\"tabs\">\n          <view\n            class=\"tab\"\n            v-for=\"tab in historySearch\"\n            :key=\"tab\"\n            @click=\"clickTab(tab)\"\n            >{{ tab }}</view\n          >\n        </view>\n      </view>\n\n      <view class=\"recommend\">\n        <view class=\"topTitle\">\n          <view class=\"text\">热门搜索</view>\n        </view>\n        <view class=\"tabs\">\n          <view\n            class=\"tab\"\n            v-for=\"tab in recommendList\"\n            :key=\"tab\"\n            @click=\"clickTab(tab)\"\n            >{{ tab }}</view\n          >\n        </view>\n      </view>\n    </view>\n\n    <view class=\"noSearch\" v-if=\"noSearch\">\n      <uv-empty mode=\"search\" icon=\"\"></uv-empty>\n    </view>\n\n    <view v-else>\n      <view class=\"list\">\n        <navigator\n          :url=\"`/pages/preview/preview?id=${item._id}`\"\n          class=\"item\"\n          v-for=\"item in classList\"\n          :key=\"item._id\"\n        >\n          <image :src=\"item.smallPicurl\" mode=\"aspectFill\"></image>\n        </navigator>\n      </view>\n      <view class=\"loadingLayout\" v-if=\"noData || classList.length\"\n        ><uni-load-more :status=\"noData ? 'noMore' : 'loading'\"\n      /></view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from \"vue\";\nimport { onLoad, onUnload, onReachBottom } from \"@dcloudio/uni-app\";\nimport { apiGetSearchData } from \"@/api/apis.js\";\n\n//查询参数\nconst queryParams = ref({\n  pageNum: 1,\n  pageSize: 12,\n  keyword: \"\",\n});\n\n//搜索历史词\nconst historySearch = ref(uni.getStorageSync(\"historySearch\") || []);\n\n//热门搜索词\nconst recommendList = ref([\"美女\", \"帅哥\", \"宠物\", \"卡通\"]);\n\n//没有更多\nconst noData = ref(false);\n//没有搜索结果\nconst noSearch = ref(false);\n\n//搜索结果列表\nconst classList = ref([]);\n\n//点击搜索\nconst onSearch = () => {\n  uni.showLoading();\n  historySearch.value = [\n    ...new Set([queryParams.value.keyword, ...historySearch.value]),\n  ].slice(0, 10); // 保留最近10条搜索记录\n  uni.setStorageSync(\"historySearch\", historySearch.value);\n  console.log(queryParams.value.keyword);\n  initParams(queryParams.value.keyword);\n  searchWall();\n};\n\n//点击清除按钮\nconst onClear = () => {\n  initParams();\n};\n\n//点击标签进行搜索\nconst clickTab = (value) => {\n  initParams(value);\n  onSearch();\n};\n\n//点击清空搜索记录\nconst removeHistory = () => {\n  uni.showModal({\n    title: \"是否清空历史搜索？\",\n    success: (res) => {\n      if (res.confirm) {\n        uni.removeStorageSync(\"historySearch\");\n        historySearch.value = [];\n      }\n    },\n  });\n};\n\n//触底加载更多\nonReachBottom(() => {\n  if (noData.value) return;\n  queryParams.value.pageNum++;\n  searchWall();\n});\n\n//关闭所有页面\nonUnload(() => {\n  uni.removeStorageSync(\"storageClassList\");\n});\n\nconst searchWall = async () => {\n  try {\n    let res = await apiGetSearchData(queryParams.value);\n    console.log(\"搜索结果:\", res);\n    classList.value = [...classList.value, ...res.data];\n    uni.setStorageSync(\"storageClassList\", classList.value);\n    if (queryParams.value.pageSize > res.data.length) noData.value = true; // 没有更多数据\n    if (res.data.length === 0 && classList.value.length === 0)\n      noSearch.value = true; // 没有搜索结果\n  } finally {\n    uni.hideLoading();\n  }\n};\n\nconst initParams = (value) => {\n  classList.value = [];\n  queryParams.value = {\n    pageNum: 1,\n    pageSize: 12,\n    keyword: value || \"\",\n  };\n  noData.value = false;\n  noSearch.value = false;\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.searchLayout {\n  .search {\n    padding: 0 10rpx;\n  }\n  .topTitle {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-size: 32rpx;\n    color: #999;\n  }\n  .history {\n    padding: 30rpx;\n  }\n  .recommend {\n    padding: 30rpx;\n  }\n  .tabs {\n    display: flex;\n    align-items: center;\n    flex-wrap: wrap;\n    padding-top: 20rpx;\n    .tab {\n      background: #f4f4f4;\n      font-size: 28rpx;\n      color: #333;\n      padding: 10rpx 28rpx;\n      border-radius: 50rpx;\n      margin-right: 20rpx;\n      margin-top: 20rpx;\n    }\n  }\n  .list {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 5rpx;\n    padding: 20rpx 5rpx;\n    .item {\n      height: 440rpx;\n      image {\n        width: 100%;\n        height: 100%;\n        display: block;\n      }\n    }\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/extest/wallpaper-engine/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onReachBottom","onUnload","apiGetSearchData"],"mappings":";;;;;;;;;;;;;;;;;;;;AA6EA,UAAM,cAAcA,cAAAA,IAAI;AAAA,MACtB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA,IACX,CAAC;AAGD,UAAM,gBAAgBA,cAAG,IAACC,cAAG,MAAC,eAAe,eAAe,KAAK,CAAA,CAAE;AAGnE,UAAM,gBAAgBD,cAAG,IAAC,CAAC,MAAM,MAAM,MAAM,IAAI,CAAC;AAGlD,UAAM,SAASA,cAAAA,IAAI,KAAK;AAExB,UAAM,WAAWA,cAAAA,IAAI,KAAK;AAG1B,UAAM,YAAYA,cAAAA,IAAI,CAAA,CAAE;AAGxB,UAAM,WAAW,MAAM;AACrBC,oBAAG,MAAC,YAAW;AACf,oBAAc,QAAQ;AAAA,QACpB,GAAG,oBAAI,IAAI,CAAC,YAAY,MAAM,SAAS,GAAG,cAAc,KAAK,CAAC;AAAA,MAClE,EAAI,MAAM,GAAG,EAAE;AACbA,oBAAAA,MAAI,eAAe,iBAAiB,cAAc,KAAK;AACvDA,oBAAA,MAAA,MAAA,OAAA,kCAAY,YAAY,MAAM,OAAO;AACrC,iBAAW,YAAY,MAAM,OAAO;AACpC;IACF;AAGA,UAAM,UAAU,MAAM;AACpB;IACF;AAGA,UAAM,WAAW,CAAC,UAAU;AAC1B,iBAAW,KAAK;AAChB;IACF;AAGA,UAAM,gBAAgB,MAAM;AAC1BA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACfA,gCAAI,kBAAkB,eAAe;AACrC,0BAAc,QAAQ;UACvB;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGAC,kBAAAA,cAAc,MAAM;AAClB,UAAI,OAAO;AAAO;AAClB,kBAAY,MAAM;AAClB;IACF,CAAC;AAGDC,kBAAAA,SAAS,MAAM;AACbF,0BAAI,kBAAkB,kBAAkB;AAAA,IAC1C,CAAC;AAED,UAAM,aAAa,YAAY;AAC7B,UAAI;AACF,YAAI,MAAM,MAAMG,SAAAA,iBAAiB,YAAY,KAAK;AAClDH,sBAAY,MAAA,MAAA,OAAA,kCAAA,SAAS,GAAG;AACxB,kBAAU,QAAQ,CAAC,GAAG,UAAU,OAAO,GAAG,IAAI,IAAI;AAClDA,sBAAAA,MAAI,eAAe,oBAAoB,UAAU,KAAK;AACtD,YAAI,YAAY,MAAM,WAAW,IAAI,KAAK;AAAQ,iBAAO,QAAQ;AACjE,YAAI,IAAI,KAAK,WAAW,KAAK,UAAU,MAAM,WAAW;AACtD,mBAAS,QAAQ;AAAA,MACvB,UAAY;AACRA,sBAAG,MAAC,YAAW;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,aAAa,CAAC,UAAU;AAC5B,gBAAU,QAAQ;AAClB,kBAAY,QAAQ;AAAA,QAClB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,SAAS,SAAS;AAAA,MACtB;AACE,aAAO,QAAQ;AACf,eAAS,QAAQ;AAAA,IACnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvKA,GAAG,WAAW,eAAe;"}